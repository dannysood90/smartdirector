<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartDirector©</title>
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover"
  />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.4;
      color: #0a0a0a;
    }

    html,
    body {
      height: 100%;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f4f5f7;
      display: flex;
      justify-content: center;
    }

    .container {
      max-width: 800px;
      width: 100%;
      padding: 24px 16px 32px;
    }

    .card {
      background: #ffffff;
      border-radius: 20px;
      padding: 24px 20px 20px;
      box-shadow: 0 12px 30px rgba(15, 23, 42, 0.08);
    }

    h1 {
      font-size: 1.7rem;
      margin-top: 0;
      margin-bottom: 0.3rem;
    }

    .subtitle {
      margin-top: 0;
      margin-bottom: 1.25rem;
      color: #596172;
      font-size: 0.95rem;
    }

    .controls-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 0.75rem;
    }

    .muted {
      font-size: 0.8rem;
      color: #8b94a7;
    }

    .reset-btn {
      padding: 4px 12px;
      border-radius: 999px;
      border: 1px solid #d0d5dd;
      background: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .reset-btn:hover {
      background: #eef2f7;
    }

    .section-card {
      background: #f9fafb;
      border-radius: 16px;
      padding: 14px 14px 12px;
      margin-bottom: 12px;
      border: 1px solid #e1e6ee;
    }

    .section-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 8px;
      color: #111827;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px 16px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.9rem;
    }

    label {
      font-weight: 600;
      color: #333;
    }

    input[type="number"],
    select {
      padding: 9px 11px;
      border-radius: 10px;
      border: 1px solid #ccd0d5;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease, background 0.15s ease;
      background: #ffffff;
    }

    .info-inline {
      font-size: 0.8rem;
      color: #6b7280;
    }

    .inline-input {
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .currency-prefix {
      padding: 7px 10px;
      border-radius: 10px;
      background: #e5e7eb;
      border: 1px solid #ccd0d5;
    }

    .inline-input input.price-input {
      flex: 1 1 0;
      border-radius: 10px;
      border: 1px solid #ccd0d5;
      padding: 9px 11px;
      font-size: 0.95rem;
      outline: none;
      background: #ffffff;
    }

    input[type="range"] {
      width: 100%;
      cursor: pointer;
      accent-color: #15803d;
    }

    .slider-wrap {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .slider-value {
      min-width: 90px;
      font-weight: 600;
      color: #111827;
      text-align: right;
    }

    .switch-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 6px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 90px;
      height: 28px;
    }

    .switch input {
      opacity: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 2px;
      left: 2px;
      right: 2px;
      bottom: 2px;
      background-color: #e5e7eb;
      border-radius: 999px;
      transition: 0.2s;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 25px;
      width: 25px;
      left: 2px;
      bottom: 2px;
      background-color: white;
      border-radius: 50%;
      transition: 0.2s;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.25);
    }

    .switch input:checked + .slider {
      background-color: #15803d;
    }

    .switch input:checked + .slider:before {
      transform: translateX(22px);
    }

    .segmented {
      display: flex;
      width: 100%;
      padding: 2px;
      border-radius: 999px;
      background: #e5e7eb;
    }

    .segmented button {
      flex: 1;
      border: none;
      background: transparent;
      padding: 6px 0;
      border-radius: 999px;
      font-size: 0.85rem;
      cursor: pointer;
    }

    .segmented button.active {
      background: #15803d;
      color: #ffffff;
      font-weight: 600;
    }

    .results-summary {
      margin-top: 6px;
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: #15803d;
      display: none;
    }

    .results-summary.negative {
      color: #b3261e;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px;
      margin-top: 8px;
    }

    .result-card {
      padding: 14px;
      border-radius: 14px;
      background: #f8fafc;
      border: 1px solid #e1e6ee;
    }

    .result-title {
      font-size: 0.8rem;
      color: #6b7280;
      margin-bottom: 4px;
      text-transform: uppercase;
    }

    .result-value {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 2px;
    }

    .result-sub {
      font-size: 0.83rem;
      color: #4b5563;
    }

    .disclaimer {
      margin-top: 16px;
      font-size: 0.75rem;
      color: #6b7280;
    }
  </style>
</head>

<body>
  <div class="container">
    <div class="card">
      <h1>Purchase Tax Advantage Calculator</h1>
      <p class="subtitle">
        Compare making a purchase through your company versus paying for it personally from your take-home income.
        Assumes you have already used your £12,570 personal tax-free allowance. 
      </p>

      <div class="controls-header">
        <span class="muted">Adjust the assumptions to match your situation.</span>
        <button class="reset-btn" id="resetBtn">Reset to defaults</button>
      </div>

      <!-- Purchase details -->
      <div class="section-card">
        <div class="section-title">Purchase Details</div>
        <div class="grid">

          <div class="field">
            <label for="price">Item Price</label>
            <div class="inline-input">
              <span class="currency-prefix">£</span>
              <input id="price" class="price-input" type="text" inputmode="decimal" autocomplete="off" />
            </div>
            <span class="info-inline">Enter the total cost of the item.</span>
          </div>

          <div class="field">
            <label for="vatRate">VAT</label>
            <select id="vatRate">
              <option value="0.20" selected>20% (standard)</option>
              <option value="0.05">5%</option>
              <option value="0.00">0% (zero-rated)</option>
            </select>

            <div class="switch-row">
              <label class="switch">
                <input type="checkbox" id="vatOn" checked />
                <span class="slider"></span>
              </label>
              <span class="switch-label">
                VAT applies and is included in the price you entered, AND your company can reclaim it.
              </span>
            </div>
          </div>

        </div>
      </div>

      <!-- Company tax -->
      <div class="section-card">
        <div class="section-title">Company Tax</div>
        <div class="grid">

          <div class="field">
            <label for="corpProfit">Annual Profits</label>
            <div class="slider-wrap">
              <input id="corpProfit" type="range" min="50000" max="250000" step="1000" value="50000" />
              <span id="corpProfitValue" class="slider-value">£50,000</span>
            </div>
            <span class="info-inline">
              Before Corporation Tax. 19% applies up to £50k, and 25% at £250k+.
            </span>
          </div>

          <div class="field">
            <label for="corpTaxRate">Corporation Tax Rate</label>
            <div class="inline-input">
              <input id="corpTaxRate" type="range" min="19" max="25" step="0.1" value="19" />
              <span id="corpTaxRateDisplay">19.0%</span>
            </div>
          </div>

        </div>
      </div>

      <!-- Personal tax -->
      <div class="section-card">
        <div class="section-title">Personal Tax Settings</div>
        <div class="grid">

          <div class="field">
            <label>How would you pay yourself?</label>
            <div class="segmented" id="extractionSegment">
              <button type="button" data-value="dividend" class="active">Dividends</button>
              <button type="button" data-value="salary">Salary</button>
            </div>
            <select id="extractionType" style="display:none;">
              <option value="dividend" selected>Dividends</option>
              <option value="salary">Salary</option>
            </select>
          </div>

          <div class="field">
            <label for="personalTaxRate">Tax rate</label>
            <select id="personalTaxRate"></select>
            <span class="info-inline">
              Your marginal tax rate on the dividends/salary used for this purchase.
            </span>
          </div>

          <div class="field" id="employeeNiField">
            <label for="employeeNiRate">Employee NI rate</label>
            <select id="employeeNiRate">
              <option value="0.08">8% (standard)</option>
              <option value="0.02">2% (higher earnings)</option>
            </select>
          </div>

        </div>
      </div>

      <div id="resultsSummary" class="results-summary"></div>
      <div id="warningText" class="warning" style="display:none;"></div>

      <div class="results">

        <div class="result-card">
          <div class="result-title">If the company buys it</div>
          <div class="result-value" id="companyCost">£–</div>
          <div class="result-sub" id="companyDetails"></div>
        </div>

        <div class="result-card">
          <div class="result-title">Overall cost if you buy it personally</div>
          <div class="result-value" id="personalTotal">£–</div>
          <div class="result-sub" id="personalBreakdown"></div>
        </div>

      </div>

      <p class="disclaimer">
        This is a simplified calculator based on marginal UK tax and NI rates. It does not account for all edge cases
        and is for illustration only. Speak to your accountant or tax adviser before making decisions.
      </p>

    </div>
  </div>

  <script>

    const EMPLOYER_NI_RATE = 0.138;

    const dividendRates = [
      { value: 0.0875, label: "8.75% (basic-rate dividends)" },
      { value: 0.3375, label: "33.75% (higher-rate dividends)" },
      { value: 0.3935, label: "39.35% (additional-rate dividends)" }
    ];

    const salaryRates = [
      { value: 0.20, label: "20% (basic-rate salary)" },
      { value: 0.40, label: "40% (higher-rate salary)" },
      { value: 0.45, label: "45% (additional-rate salary)" }
    ];

    const CT_LOWER_PROFIT = 50000;
    const CT_UPPER_PROFIT = 250000;
    const CT_RATE_LOW = 0.19;
    const CT_RATE_HIGH = 0.25;

    function effectiveCorpRateFromProfit(profit) {
      if (profit <= CT_LOWER_PROFIT) return CT_RATE_LOW;
      if (profit >= CT_UPPER_PROFIT) return CT_RATE_HIGH;
      const t = (profit - CT_LOWER_PROFIT) / (CT_UPPER_PROFIT - CT_LOWER_PROFIT);
      return CT_RATE_LOW + t * (CT_RATE_HIGH - CT_RATE_LOW);
    }

    function estimateProfitFromRate(ratePercent) {
      const r = ratePercent / 100;
      if (r <= CT_RATE_LOW) return CT_LOWER_PROFIT;
      if (r >= CT_RATE_HIGH) return CT_UPPER_PROFIT;
      const t = (r - CT_RATE_LOW) / (CT_RATE_HIGH - CT_RATE_LOW);
      return CT_LOWER_PROFIT + t * (CT_UPPER_PROFIT - CT_LOWER_PROFIT);
    }

    function formatMoney(value) {
      return "£" + value.toLocaleString("en-GB", {
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      });
    }

    function getPriceNumeric() {
      const raw = document.getElementById("price").value.replace(/[^0-9.]/g, "");
      return parseFloat(raw) || 0;
    }

    function formatPriceField() {
      const num = getPriceNumeric();
      document.getElementById("price").value =
        num ? num.toLocaleString("en-GB") : "";
    }

    function populatePersonalTaxRates(type) {
      const select = document.getElementById("personalTaxRate");
      select.innerHTML = "";
      const list = type === "dividend" ? dividendRates : salaryRates;

      list.forEach((r, i) => {
        const opt = document.createElement("option");
        opt.value = r.value;
        opt.textContent = r.label;
        if ((type === "dividend" && i === 1) || (type === "salary" && i === 0))
          opt.selected = true;
        select.appendChild(opt);
      });
    }

    function updateNiVisibility(type) {
      document.getElementById("employeeNiField").style.display =
        type === "salary" ? "flex" : "none";
    }

    let isSyncingCorp = false;

    function updateCorpRateFromProfit() {
      if (isSyncingCorp) return;
      isSyncingCorp = true;

      const profit = parseFloat(document.getElementById("corpProfit").value);
      document.getElementById("corpProfitValue").textContent =
        "£" + profit.toLocaleString();

      const rate = effectiveCorpRateFromProfit(profit) * 100;
      document.getElementById("corpTaxRate").value = rate.toFixed(1);
      document.getElementById("corpTaxRateDisplay").textContent =
        rate.toFixed(1) + "%";

      calculate();
      isSyncingCorp = false;
    }

    function updateProfitFromCorpRate() {
      if (isSyncingCorp) return;
      isSyncingCorp = true;

      const rate = parseFloat(document.getElementById("corpTaxRate").value);
      document.getElementById("corpTaxRateDisplay").textContent =
        rate.toFixed(1) + "%";

      let est = estimateProfitFromRate(rate);
      est = Math.min(Math.max(est, 50000), 250000);
      est = Math.round(est / 1000) * 1000;

      document.getElementById("corpProfit").value = est;
      document.getElementById("corpProfitValue").textContent =
        "£" + est.toLocaleString();

      calculate();
      isSyncingCorp = false;
    }

    function setDefaults() {
      document.getElementById("price").value = "1,000";
      document.getElementById("corpProfit").value = 50000;
      document.getElementById("corpProfitValue").textContent = "£50,000";
      document.getElementById("corpTaxRate").value = 19;
      document.getElementById("corpTaxRateDisplay").textContent = "19.0%";
      document.getElementById("vatRate").value = "0.20";
      document.getElementById("vatOn").checked = true;

      document.getElementById("extractionType").value = "dividend";
      populatePersonalTaxRates("dividend");
      updateNiVisibility("dividend");
      updateExtractionSegment("dividend");
    }

    function calculate() {
      const price = getPriceNumeric();
      const corpTaxRate = parseFloat(document.getElementById("corpTaxRate").value) / 100;
      const vatOn = document.getElementById("vatOn").checked;
      const vatRate = parseFloat(document.getElementById("vatRate").value);

      const extractionType = document.getElementById("extractionType").value;
      const personalTaxRate = parseFloat(document.getElementById("personalTaxRate").value);
      const employeeNiRate =
        extractionType === "salary"
          ? parseFloat(document.getElementById("employeeNiRate").value)
          : 0;

      let netPrice = vatOn && vatRate > 0 ? price / (1 + vatRate) : price;
      const companyCost = netPrice * (1 - corpTaxRate);

      let personalCost;
      let warning = "";
      let breakdown = "";

      if (extractionType === "dividend") {
        const denom = (1 - corpTaxRate) * (1 - personalTaxRate);
        personalCost = price / denom;

        const corpTax = personalCost * corpTaxRate;
        const dividendTax = (personalCost - corpTax) * personalTaxRate;
        breakdown =
          `Considers purchase price, ${formatMoney(corpTax)} in Corporation Tax and ` +
          `${formatMoney(dividendTax)} in dividend tax.`;

      } else {
        const denom = 1 - personalTaxRate - employeeNiRate;
        personalCost = price * (1 + EMPLOYER_NI_RATE) / denom;

        const grossSalary = price / denom;
        const incomeTax = grossSalary * personalTaxRate;
        const empNI = grossSalary * employeeNiRate;
        const erNI = grossSalary * EMPLOYER_NI_RATE;

        breakdown =
          `Considers purchase price, ${formatMoney(incomeTax)} in income tax, ` +
          `${formatMoney(empNI)} in employee NI and ${formatMoney(erNI)} in employer NI.`;
      }

      const saving = personalCost - companyCost;
      const savingPercent = (saving / personalCost) * 100;

      document.getElementById("companyCost").textContent =
        formatMoney(companyCost);

      document.getElementById("companyDetails").textContent =
        vatOn && vatRate > 0
          ? `Assumes VAT at ${vatRate * 100}%, reclaimed by your company.`
          : `No VAT reclaimed.`;

      document.getElementById("personalTotal").textContent =
        formatMoney(personalCost);

      document.getElementById("personalBreakdown").textContent = breakdown;

      const summary = document.getElementById("resultsSummary");
      summary.style.display = "block";

      if (saving >= 0) {
        summary.textContent =
          `Using your limited company saves you ${formatMoney(saving)} on this purchase, ` +
          `which is ${savingPercent.toFixed(1)}% of the overall cost compared to buying it personally.`;
        summary.classList.remove("negative");
      } else {
        summary.textContent =
          `Buying personally is cheaper by ${formatMoney(-saving)} (${Math.abs(savingPercent).toFixed(1)}% difference).`;
        summary.classList.add("negative");
      }
    }

    function updateExtractionSegment(val) {
      document.querySelectorAll("#extractionSegment button")
        .forEach(btn => btn.classList.toggle("active", btn.dataset.value === val));
    }

    document.querySelectorAll("#extractionSegment button").forEach(btn => {
      btn.addEventListener("click", () => {
        const val = btn.dataset.value;
        document.getElementById("extractionType").value = val;
        populatePersonalTaxRates(val);
        updateNiVisibility(val);
        updateExtractionSegment(val);
        calculate();
      });
    });

    document.getElementById("corpProfit").addEventListener("input", updateCorpRateFromProfit);
    document.getElementById("corpTaxRate").addEventListener("input", updateProfitFromCorpRate);

    document.getElementById("price").addEventListener("blur", () => {
      formatPriceField();
      calculate();
    });

    document.getElementById("price").addEventListener("input", calculate);

    document.getElementById("resetBtn").addEventListener("click", () => {
      setDefaults();
      updateCorpRateFromProfit();
      calculate();
    });

    window.addEventListener("load", () => {
      setDefaults();
      updateCorpRateFromProfit();
      calculate();
    });
  </script>
</body>
</html>
