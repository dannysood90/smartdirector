<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>SmartDirector: Purchase Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      line-height: 1.4;
    }

    body {
      margin: 0;
      padding: 0;
      background: #f4f5f7;
      display: flex;
      justify-content: center;
    }

    .container {
      max-width: 800px;
      width: 100%;
      padding: 24px;
    }

    .card {
      background: #ffffff;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 4px 16px rgba(0,0,0,0.06);
    }

    h1 {
      font-size: 1.5rem;
      margin-top: 0;
      margin-bottom: 0.25rem;
    }

    .subtitle {
      margin-top: 0;
      margin-bottom: 1rem;
      color: #555;
      font-size: 0.95rem;
    }

    .controls-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 0.75rem;
    }

    .reset-btn {
      padding: 4px 10px;
      border-radius: 999px;
      border: 1px solid #d0d5dd;
      background: #f9fafb;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .reset-btn:hover {
      background: #eef2f7;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(230px, 1fr));
      gap: 16px 24px;
      margin-bottom: 1.5rem;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
      font-size: 0.9rem;
    }

    label {
      font-weight: 600;
      color: #333;
    }

    input[type="number"],
    select {
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #ccd0d5;
      font-size: 0.95rem;
      outline: none;
      transition: border-color 0.15s ease, box-shadow 0.15s ease;
      background: #fff;
    }

    input[type="number"]:focus,
    select:focus {
      border-color: #1f7ae0;
      box-shadow: 0 0 0 2px rgba(31,122,224,0.15);
    }

    .checkbox-row {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    .checkbox-row label {
      font-weight: 500;
    }

    .muted {
      font-size: 0.8rem;
      color: #777;
    }

    .info-inline {
      font-size: 0.8rem;
      color: #555;
      font-style: italic;
    }

    .results-summary {
      margin-bottom: 0.75rem;
      font-size: 0.95rem;
      font-weight: 600;
      color: #1a7f37;
    }

    .results-summary.negative {
      color: #b3261e;
    }

    .warning {
      margin-top: 0.5rem;
      font-size: 0.8rem;
      color: #b3261e;
    }

    .results {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-top: 8px;
    }

    .result-card {
      padding: 16px;
      border-radius: 10px;
      background: #f8fafc;
      border: 1px solid #e1e6ee;
    }

    .result-title {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: #777;
      margin-bottom: 4px;
    }

    .result-value {
      font-size: 1.35rem;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .result-sub {
      font-size: 0.85rem;
      color: #666;
    }

    .saving-positive {
      color: #1a7f37;
    }

    .saving-negative {
      color: #b3261e;
    }

    .disclaimer {
      margin-top: 16px;
      font-size: 0.75rem;
      color: #777;
    }

    @media (max-width: 600px) {
      .card {
        padding: 18px;
      }
      .grid {
        gap: 12px 16px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <h1>SmartDirector© Purchase Calculator</h1>
      <p class="subtitle">
        Compare the real cost of buying something through your limited company versus buying it personally using money withdrawn as salary or dividends (after tax).
      </p>

      <div class="controls-header">
        <span class="muted">Adjust the assumptions below to match your situation.</span>
        <button class="reset-btn" type="button" id="resetBtn">Reset to defaults</button>
      </div>

      <div class="grid">
        <div class="field">
          <label for="price">Item price</label>
          <input id="price" type="number" min="0" step="0.01" value="1000" />
          <span class="muted">Enter the price of the item.</span>

          <div class="checkbox-row">
            <input type="checkbox" id="priceIncludesVat" checked />
            <label for="priceIncludesVat" class="muted">
              Price includes VAT
            </label>
          </div>
        </div>

        <div class="field">
          <label for="corpTaxRate">Corporation Tax rate</label>
          <select id="corpTaxRate">
            <option value="0.19">19%</option>
            <option value="0.20" selected>20%</option>
            <option value="0.25">25%</option>
          </select>
          <span class="muted">Used for company tax relief and dividend calculations.</span>
        </div>

        <div class="field">
          <label>VAT</label>

          <select id="vatRate" style="margin-top: 6px;">
            <option value="0.20" selected>20% (standard)</option>
            <option value="0.05">5%</option>
            <option value="0.00">0% (zero-rated)</option>
          </select>

          <div class="checkbox-row" style="margin-top: 6px;">
            <input type="checkbox" id="vatOn" checked />
            <label for="vatOn" style="font-size: 0.8rem; font-style: italic;">
              VAT applies and can be reclaimed
            </label>
          </div>
        </div>

        <div class="field">
          <label for="extractionType">How would you pay yourself a salary/dividends?</label>
          <select id="extractionType">
            <option value="dividend" selected>Dividends</option>
            <option value="salary">Salary</option>
          </select>
        </div>

        <div class="field">
          <label for="personalTaxRate">Tax Rate</label>
          <!-- Populated dynamically based on extraction type -->
          <select id="personalTaxRate"></select>
          <span class="muted">
            This is your marginal tax rate on dividends/salary used for this purchase.
          </span>
        </div>

        <div class="field" id="employeeNiField">
          <label for="employeeNiRate">
            Employee NI rate on this extra salary
            <span class="info-inline">(employer NI is also included in the cost)</span>
          </label>
          <select id="employeeNiRate">
            <option value="0.08" selected>8% (between £12,570 and £50,270)</option>
            <option value="0.02">2% (over £50,270)</option>
          </select>
          <span class="muted">
            Select 8% unless your total salary (not dividends) is over £50,270. Most directors take a salary of around £12,570.
          </span>
        </div>
      </div>

      <div id="resultsSummary" class="results-summary" style="display:none;"></div>
      <div id="warningText" class="warning" style="display:none;"></div>

      <div class="results">
        <div class="result-card">
          <div class="result-title">If the company buys it</div>
          <div class="result-value" id="companyCost">£–</div>
          <div class="result-sub" id="companyDetails"></div>
        </div>

        <div class="result-card">
          <div class="result-title">Overall cost if you buy it personally</div>
          <div class="result-value" id="personalTotal">£–</div>
          <div class="result-sub" id="personalBreakdown"></div>
        </div>

        <div class="result-card">
          <div class="result-title">Saving by using the company</div>
          <div class="result-value" id="savingAmount">£–</div>
          <div class="result-sub" id="savingDetails"></div>
        </div>
      </div>

      <p class="disclaimer">
        This is a simplified calculator based on marginal UK tax and NI rates. It does not account for all edge cases
        (allowances, thresholds, benefits, etc.) and is for illustration only. It is not tax advice. Please speak to
        your accountant or tax adviser before making decisions.
      </p>
    </div>
  </div>

  <script>
    // Employer NI (standard Class 1 secondary rate)
    const EMPLOYER_NI_RATE = 0.138;  // 13.8% employer Class 1

    const dividendRates = [
      { value: 0.0875, label: "8.75% (basic-rate dividends)" },
      { value: 0.3375, label: "33.75% (higher-rate dividends)" },
      { value: 0.3935, label: "39.35% (additional-rate dividends)" }
    ];

    const salaryRates = [
      { value: 0.20, label: "20% (basic-rate salary)" },
      { value: 0.40, label: "40% (higher-rate salary)" },
      { value: 0.45, label: "45% (additional-rate salary)" }
    ];

    function formatMoney(value) {
      if (!isFinite(value)) return "£–";
      return "£" + value.toFixed(2);
    }

    function formatPercent(value) {
      if (!isFinite(value)) return "–%";
      return (value * 100).toFixed(1) + "%";
    }

    function populatePersonalTaxRates(extractionType) {
      const select = document.getElementById("personalTaxRate");
      select.innerHTML = ""; // clear existing options

      const rates = extractionType === "dividend" ? dividendRates : salaryRates;

      rates.forEach((rate, index) => {
        const opt = document.createElement("option");
        opt.value = rate.value;
        opt.textContent = rate.label;

        // Default selection
        if (extractionType === "salary" && index === 0) {
          opt.selected = true; // 20% salary
        }
        if (extractionType === "dividend" && index === 1) {
          opt.selected = true; // 33.75% dividends
        }

        select.appendChild(opt);
      });
    }

    function updateNiVisibility(extractionType) {
      const niField = document.getElementById("employeeNiField");
      if (extractionType === "salary") {
        niField.style.display = "flex";
      } else {
        niField.style.display = "none";
      }
    }

    function setDefaults() {
      document.getElementById("price").value = 1000;
      document.getElementById("priceIncludesVat").checked = true;
      document.getElementById("corpTaxRate").value = "0.20";
      document.getElementById("vatRate").value = "0.20";
      document.getElementById("vatOn").checked = true;
      document.getElementById("extractionType").value = "dividend";
      populatePersonalTaxRates("dividend");
      document.getElementById("employeeNiRate").value = "0.08";
      updateNiVisibility("dividend");
    }

    function calculate() {
      const priceInput = parseFloat(document.getElementById("price").value) || 0;
      const corpTaxRate = parseFloat(document.getElementById("corpTaxRate").value) || 0;
      const vatOn = document.getElementById("vatOn").checked;
      const vatRate = parseFloat(document.getElementById("vatRate").value) || 0;
      const priceIncludesVat = document.getElementById("priceIncludesVat").checked;
      const extractionType = document.getElementById("extractionType").value;
      const personalTaxRate = parseFloat(document.getElementById("personalTaxRate").value) || 0;
      const employeeNiRate = extractionType === "salary"
        ? parseFloat(document.getElementById("employeeNiRate").value) || 0
        : 0;

      // COMPANY COST:
      // Determine net cost (P&L) depending on VAT behaviour
      let netPrice;
      let grossPriceForPersonal;

      if (vatOn && vatRate > 0) {
        if (priceIncludesVat) {
          // Price is VAT-inclusive: company sees net cost = price / (1+vat)
          netPrice = priceInput / (1 + vatRate);
          grossPriceForPersonal = priceInput; // director pays the sticker price
        } else {
          // Price is ex-VAT: company net cost = price; director pays price + VAT
          netPrice = priceInput;
          grossPriceForPersonal = priceInput * (1 + vatRate);
        }
      } else {
        // No VAT to reclaim / ignore VAT
        netPrice = priceInput;
        grossPriceForPersonal = priceInput;
      }

      const companyCost = netPrice * (1 - corpTaxRate);

      // PERSONAL ROUTE:
      // For personal route, we use the gross amount the director must spend.
      const personalSpend = grossPriceForPersonal;

      // Dividends: pre-tax profit needed = personalSpend / ((1 - CT) * (1 - dividend tax))
      //
      // Salary:
      //   Net to director N = S * (1 - incomeTax - employeeNI)
      //   Company cost (salary + employer NI) = S * (1 + employerNI)
      //   => cost = N * (1 + employerNI) / (1 - incomeTax - employeeNI)
      let personalCost;
      let warningText = "";
      let breakdownText = "";

      if (extractionType === "dividend") {
        const denom = (1 - corpTaxRate) * (1 - personalTaxRate);
        if (denom <= 0.05) {
          warningText =
            "Your selected Corporation Tax and dividend tax rates make personal extraction extremely inefficient. " +
            "Check that the rates reflect your real marginal position.";
        }
        personalCost = denom > 0 ? personalSpend / denom : Infinity;

        // Breakdown for dividends
        if (denom > 0 && isFinite(personalCost)) {
          const preTaxProfit = personalCost; // by construction
          const corpTax = preTaxProfit * corpTaxRate;
          const postTaxProfit = preTaxProfit - corpTax;
          const grossDividend = postTaxProfit; // all available is paid as dividend
          const dividendTax = grossDividend * personalTaxRate;

          breakdownText =
            `Includes about ${formatMoney(corpTax)} in Corporation Tax and ` +
            `${formatMoney(dividendTax)} in dividend tax to leave you with ` +
            `${formatMoney(personalSpend)} to spend personally.`;
        }
      } else {
        const denom = 1 - personalTaxRate - employeeNiRate;
        if (denom <= 0.05) {
          warningText =
            "With this combination of income tax and NI, taking extra salary is extremely inefficient. " +
            "Consider whether dividends or a different structure is more realistic.";
        }
        personalCost = denom > 0 ? personalSpend * (1 + EMPLOYER_NI_RATE) / denom : Infinity;

        // Breakdown for salary
        if (denom > 0 && isFinite(personalCost)) {
          const grossSalary = personalSpend / denom;
          const incomeTax = grossSalary * personalTaxRate;
          const employeeNI = grossSalary * employeeNiRate;
          const employerNI = grossSalary * EMPLOYER_NI_RATE;

          breakdownText =
            `Includes about ${formatMoney(incomeTax)} in income tax, ` +
            `${formatMoney(employeeNI)} in employee NI and ` +
            `${formatMoney(employerNI)} in employer NI to leave you with ` +
            `${formatMoney(personalSpend)} to spend personally.`;
        }
      }

      const saving = personalCost - companyCost;
      const savingPercent = personalCost > 0 ? saving / personalCost : 0;

      // Update UI
      const companyCostEl = document.getElementById("companyCost");
      const companyDetailsEl = document.getElementById("companyDetails");
      const personalTotalEl = document.getElementById("personalTotal");
      const personalBreakdownEl = document.getElementById("personalBreakdown");
      const savingAmountEl = document.getElementById("savingAmount");
      const savingDetailsEl = document.getElementById("savingDetails");
      const resultsSummaryEl = document.getElementById("resultsSummary");
      const warningEl = document.getElementById("warningText");

      companyCostEl.textContent = formatMoney(companyCost);

      let vatText;
      if (vatOn && vatRate > 0) {
        vatText = priceIncludesVat
          ? `Assumes VAT at ${formatPercent(vatRate)} is reclaimed from a VAT-inclusive price. `
          : `Assumes VAT at ${formatPercent(vatRate)} is reclaimed on top of the net price. `;
      } else {
        vatText = "No VAT reclaimed or VAT not applicable. ";
      }
      let corpText = `Corporation Tax relief at ${formatPercent(corpTaxRate)} on the net cost.`;

      companyDetailsEl.textContent = vatText + corpText;

      // Overall personal route cost
      personalTotalEl.textContent = formatMoney(personalCost);
      personalBreakdownEl.textContent = breakdownText || "";

      // Saving card + summary
      savingAmountEl.textContent = formatMoney(saving);
      savingAmountEl.classList.remove("saving-positive", "saving-negative");
      resultsSummaryEl.classList.remove("negative");
      resultsSummaryEl.style.display = "block";

      if (saving > 0.005) {
        savingAmountEl.classList.add("saving-positive");
        savingDetailsEl.textContent =
          `Using the company is cheaper by ${formatMoney(saving)} ` +
          `(${(savingPercent * 100).toFixed(1)}% of the overall personal cost).`;
        resultsSummaryEl.textContent =
          `Using your limited company saves you ${formatMoney(saving)} on this purchase.`;
      } else if (saving < -0.005) {
        savingAmountEl.classList.add("saving-negative");
        savingDetailsEl.textContent =
          `Using the company is more expensive by ${formatMoney(-saving)} ` +
          `(${(Math.abs(savingPercent) * 100).toFixed(1)}% more than buying personally).`;
        resultsSummaryEl.textContent =
          `In this scenario, buying personally is cheaper by ${formatMoney(-saving)}.`;
        resultsSummaryEl.classList.add("negative");
      } else {
        savingDetailsEl.textContent = "No meaningful difference between the two options.";
        resultsSummaryEl.textContent =
          "There’s very little difference between company and personal in this scenario.";
      }

      // Warning text
      if (warningText) {
        warningEl.textContent = warningText;
        warningEl.style.display = "block";
      } else {
        warningEl.style.display = "none";
      }
    }

    // Recalculate whenever inputs change
    document.querySelectorAll(
      "#price, #corpTaxRate, #vatOn, #vatRate, #priceIncludesVat, #extractionType, #personalTaxRate, #employeeNiRate"
    ).forEach(el => {
      el.addEventListener("input", calculate);
      el.addEventListener("change", calculate);
    });

    // Disable VAT rate dropdown when VAT is off
    document.getElementById("vatOn").addEventListener("change", (e) => {
      document.getElementById("vatRate").disabled = !e.target.checked;
      calculate();
    });

    // When extraction type changes, repopulate the tax rates and toggle NI field
    document.getElementById("extractionType").addEventListener("change", (e) => {
      const type = e.target.value;
      populatePersonalTaxRates(type);
      updateNiVisibility(type);
      calculate();
    });

    // Reset button
    document.getElementById("resetBtn").addEventListener("click", () => {
      setDefaults();
      calculate();
    });

    // Initial setup
    setDefaults();
    calculate();
  </script>
</body>
</html>
